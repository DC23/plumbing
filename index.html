

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Package ‘plumbing’ documentation</title>
    
    <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="top" title="None" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">plumbing v1.1.1</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-plumbing">
<span id="package-plumbing-documentation"></span><h1>Package <em>&#8216;plumbing&#8217;</em> documentation<a class="headerlink" href="#module-plumbing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The plumbing software is a package written in Python. It is designed to help with plumbing-type programmation.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install you can simply type:</p>
<div class="highlight-python"><pre>$ sudo easy_install plumbing</pre>
</div>
<p>That&#8217;s it. However, if that doesn&#8217;t work because you don&#8217;t have sufficient permissions, you can simply install it somewhere else (for instance in your home):</p>
<div class="highlight-python"><pre>$ easy_install --user plumbing</pre>
</div>
</div>
<span class="target" id="module-plumbing.cmd"></span><div class="section" id="warping-programs">
<h2>Warping programs<a class="headerlink" href="#warping-programs" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">&#64;command</span></tt> decorator makes binding command line executables
easy to write and easy to use.</p>
<p>To wrap a program, write a function that takes whatever arguments
you will need to run the program like if it where on the shell.
The function should return a dictionary containing several keys:</p>
<blockquote>
<div><ul class="simple">
<li>mandatory: <tt class="docutils literal"><span class="pre">arguments</span></tt></li>
<li>optional: <tt class="docutils literal"><span class="pre">stdin</span></tt></li>
<li>optional: <tt class="docutils literal"><span class="pre">return_value</span></tt>.</li>
</ul>
</div></blockquote>
<p>Firstly, <tt class="docutils literal"><span class="pre">arguments</span></tt> should be a list of strings which is
the actual command and arguments to be executed (e.g. <tt class="docutils literal"><span class="pre">[&quot;touch&quot;,</span> <span class="pre">filename]</span></tt>).</p>
<p>Secondly, <tt class="docutils literal"><span class="pre">stdin</span></tt> should be a value to feed the subprocess once it is launched.</p>
<p>Thirdly, <tt class="docutils literal"><span class="pre">return_value</span></tt> should be a value to return, or a callable
object which takes <tt class="docutils literal"><span class="pre">(stdout,strerr)</span></tt> as parameters and returns the value
that will be passed back to the user when this program is run.
You can also simply specify <tt class="docutils literal"><span class="pre">&quot;stdout&quot;</span></tt> to have the output of the
process returned directly.</p>
<p>For example, to wrap <tt class="docutils literal"><span class="pre">touch</span></tt>, we write a one argument function that
takes the filename of the file to touch, and apply the <tt class="docutils literal"><span class="pre">&#64;command</span></tt>
decorator to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plumbing</span> <span class="kn">import</span> <span class="n">command</span>

<span class="nd">@command</span>
<span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span>
            <span class="s">&quot;return_value&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">}</span>
</pre></div>
</div>
<p>We can now call this function directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">touch</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The value returned by touch is <tt class="docutils literal"><span class="pre">&quot;myfile&quot;</span></tt>, the name of
the touched file.</p>
<p>A more complicated example would include binding the BLASTP algorithm:</p>
<div class="highlight-python"><pre>from plumbing import command

@command
def blastp(database, sequences, **kwargs):
    """Will launch the 'blastp' algorithm using the NCBI executable.

   :param database: The path to the database to blast against.
   :param sequences: A fasta formated string.
   :param **kwargs: Extra parameters that will be passed to the executable
                    For instance, you could specify "e=1e-20".
   :returns: A list of top hits in blast format.
   """
    return {"arguments": ["blastall", "-p", "blastp", "-d" database] +
                         [a for k,v in kwargs.items() for a in ('-'+k,v)],
            "stdin": sequences)
            "return_value": 'stdout'}</pre>
</div>
<p>As shown above, we can now call this function directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">hits</span> <span class="o">=</span> <span class="n">blastp</span><span class="p">(</span><span class="s">&quot;swissprot&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;proteins.fasta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
<p>The value returned by blastp is a long string containing all the
results from the BLASTP algorithm.</p>
<p>Often you want to call a function, but not block when it returns
so you can run several in parallel. <tt class="docutils literal"><span class="pre">&#64;command</span></tt> also creates a
method <tt class="docutils literal"><span class="pre">parallel</span></tt> which does this. The return value is a
Future object with a single method: <tt class="docutils literal"><span class="pre">wait()</span></tt>. When you call
<tt class="docutils literal"><span class="pre">wait()</span></tt>, it blocks until the program finishes, then returns the
same value that you would get from calling the function directly.
So, to touch two files, and not block until both commands have
started, you would write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">blastp</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="s">&quot;nr&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;fasta1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">e</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">blastp</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="s">&quot;nr&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;fasta2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">e</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">)</span>
<span class="n">hitsA</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="n">hitsB</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">parallel</span></tt> method will runs processes without blocking.
Other methods exists for running commands in parallel.
For example, on systems using the SLURM batch submission
system, you can run commands via batch submission by using the
<tt class="docutils literal"><span class="pre">slurm</span></tt> method and optionally adding the time and account info:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">blastp</span><span class="o">.</span><span class="n">slurm</span><span class="p">(</span><span class="s">&quot;nr&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;fasta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">time</span><span class="o">=</span><span class="s">&#39;1:00:00&#39;</span><span class="p">)</span>
<span class="n">hits</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>On systems using the LSF batch submission system, you can run
commands via batch submission by using the <tt class="docutils literal"><span class="pre">lsf</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">blastp</span><span class="o">.</span><span class="n">lsf</span><span class="p">(</span><span class="s">&quot;nr&quot;</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;fasta&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="n">queue</span><span class="o">=</span><span class="s">&#39;long&#39;</span><span class="p">)</span>
<span class="n">hits</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Package <em>&#8216;plumbing&#8217;</em> documentation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#warping-programs">Warping programs</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">plumbing v1.1.1</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Last updated on Sep 28, 2012.
    <a href="http://opensource.org/licenses/MIT"><p>MIT licensed</p></a>
    </div>
  </body>
</html>