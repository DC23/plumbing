

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Package ‘plumbing’ documentation</title>
    
    <link rel="stylesheet" href="_static/rtd.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="shortcut icon" href="_static/logo.png"/>
    <link rel="top" title="None" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">plumbing v1.0.0</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-plumbing">
<span id="package-plumbing-documentation"></span><h1>Package <em>&#8216;plumbing&#8217;</em> documentation<a class="headerlink" href="#module-plumbing" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The plumbing software is a package written in Python. It is designed to help with plumbing-type programmation.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To install you can simply type:</p>
<div class="highlight-python"><pre>$ sudo easy_install plumbing</pre>
</div>
<p>That&#8217;s it. However, if that doesn&#8217;t work because you don&#8217;t have sufficient permissions, you can simply install it somewhere else (for instance in your home):</p>
<div class="highlight-python"><pre>$ cd ~
$ pip install -e git+https://github.com/xapple/plumbing</pre>
</div>
</div>
<span class="target" id="module-plumbing.cmd"></span><div class="section" id="warping-programs">
<h2>Warping programs<a class="headerlink" href="#warping-programs" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">&#64;command</span></tt> decorator makes binding command line executables
easy to write and easy to use.</p>
<p>To wrap a program, write a function that takes whatever arguments
you will need. The function should return a dictionary containing two keys,
<tt class="docutils literal"><span class="pre">arguments</span></tt> and optionally <tt class="docutils literal"><span class="pre">return_value</span></tt>.
Firstly, <tt class="docutils literal"><span class="pre">arguments</span></tt> should point to a list of strings which is
the actual command and arguments to be executed (e.g. <tt class="docutils literal"><span class="pre">[&quot;touch&quot;,</span> <span class="pre">filename]</span></tt>).
Secondly, <tt class="docutils literal"><span class="pre">return_value</span></tt> can point to a value to return, or a callable
object which takes a <tt class="docutils literal"><span class="pre">CommandOutput</span></tt> object and returns the value
that will be passed back to the user when this program is run.</p>
<p>For example, to wrap <tt class="docutils literal"><span class="pre">touch</span></tt>, we write a one argument function that
takes the filename of the file to touch, and apply the <tt class="docutils literal"><span class="pre">&#64;command</span></tt>
decorator to it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">plumbing</span> <span class="kn">import</span> <span class="n">command</span>

<span class="nd">@command</span>
<span class="k">def</span> <span class="nf">touch</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;touch&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span>
            <span class="s">&quot;return_value&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">}</span>
</pre></div>
</div>
<p>We can now call this function directly:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">f</span> <span class="o">=</span> <span class="n">touch</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The value returned by touch is <tt class="docutils literal"><span class="pre">&quot;myfile&quot;</span></tt>, the name of
the touched file.</p>
<p>Often you want to call a function, but not block when it returns
so you can run several in parallel. <tt class="docutils literal"><span class="pre">&#64;command</span></tt> also creates a
method <tt class="docutils literal"><span class="pre">parallel</span></tt> which does this. The return value is a
Future object with a single method: <tt class="docutils literal"><span class="pre">wait()</span></tt>. When you call
<tt class="docutils literal"><span class="pre">wait()</span></tt>, it blocks until the program finishes, then returns the
same value that you would get from calling the function directly.
So, to touch two files, and not block until both commands have
started, you would write:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="s">&quot;myfile1&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="s">&quot;myfile2&quot;</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="n">b</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">parallel</span></tt> method will runs processes in different threads.
Other methods exists for running commands in parallel.
For example, on systems using the LSF batch submission
system, you can run commands via batch submission by using the
<tt class="docutils literal"><span class="pre">lsf</span></tt> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">touch</span><span class="o">.</span><span class="n">lsf</span><span class="p">(</span><span class="s">&quot;myfile&quot;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
</pre></div>
</div>
<p>Some programs do not accept an output file as an argument and only
write to <tt class="docutils literal"><span class="pre">stdout</span></tt>. Alternately, you might need to capture
<tt class="docutils literal"><span class="pre">stderr</span></tt> to a file. All the methods of <tt class="docutils literal"><span class="pre">&#64;command</span></tt> accept
keyword arguments <tt class="docutils literal"><span class="pre">stdout</span></tt> and <tt class="docutils literal"><span class="pre">stderr</span></tt> to specify files to
write these streams to. If they are omitted, then both streams
are captured and returned in the <tt class="docutils literal"><span class="pre">CommandOutput</span></tt> object.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="#">
              <img class="logo" src="_static/logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="#">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Package <em>&#8216;plumbing&#8217;</em> documentation</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#warping-programs">Warping programs</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="#">plumbing v1.0.0</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Last updated on Aug 26, 2012.
    <a href="http://opensource.org/licenses/MIT"><p>MIT licensed</p></a>
    </div>
  </body>
</html>